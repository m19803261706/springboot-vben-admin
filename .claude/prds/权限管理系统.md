# 权限管理系统 PRD

> 创建时间: 2026-01-13
> 优先级: P0 - 紧急

## 1. 功能概述

构建一套完整的 RBAC (基于角色的访问控制) 权限管理系统，实现：
- 用户、角色、菜单、部门的精细化管理
- 菜单权限控制（不同用户/角色看到不同菜单）
- 按钮级权限控制（页面内按钮的显示/隐藏）
- 数据权限控制（按部门/个人隔离数据）

参考 JeecgBoot 等成熟框架的权限设计。

## 2. 核心模块

### 2.1 用户管理 (sys_user)
- 用户列表（分页、搜索、筛选）
- 用户新增/编辑（账号、密码、姓名、手机、邮箱、状态）
- 用户删除（软删除）
- 用户分配角色（多角色）
- 用户所属部门
- 重置密码
- 启用/禁用

### 2.2 角色管理 (sys_role)
- 角色列表
- 角色新增/编辑（角色名、角色编码、排序、状态）
- 角色删除
- 角色分配菜单权限（树形勾选）
- 角色配置数据权限范围

### 2.3 菜单管理 (sys_menu)
- 菜单树展示
- 菜单新增/编辑
  - 菜单类型：目录 / 菜单 / 按钮
  - 菜单名称、图标、路由路径、组件路径
  - 权限标识（如 `sys:user:add`）
  - 排序、状态
- 菜单删除（级联删除子菜单）
- 按钮权限配置（挂在菜单下）

### 2.4 部门管理 (sys_dept)
- 部门树展示
- 部门新增/编辑（部门名称、上级部门、负责人、排序）
- 部门删除（需检查是否有用户）
- 支持多级部门结构

## 3. 数据权限设计

### 3.1 数据权限类型

| 类型 | 编码 | 说明 |
|------|------|------|
| 全部数据 | DATA_SCOPE_ALL | 可查看所有数据 |
| 本部门数据 | DATA_SCOPE_DEPT | 只能查看本部门数据 |
| 本部门及下级 | DATA_SCOPE_DEPT_AND_CHILD | 本部门 + 所有下级部门 |
| 仅本人数据 | DATA_SCOPE_SELF | 只能查看自己创建的数据 |
| 自定义 | DATA_SCOPE_CUSTOM | 自定义指定部门 |

### 3.2 实现方式

```java
// 数据权限注解
@DataScope(deptAlias = "d", userAlias = "u")
public List<User> selectUserList(User user) {
    // SQL 自动拼接数据权限条件
}
```

## 4. 技术要求

### 4.1 后端技术栈
- Spring Boot 4.0.1
- Sa-Token 1.38+ (登录认证 + 权限校验)
- Spring Data JPA (数据访问)
- MySQL 8.0

### 4.2 前端技术栈
- Vben Admin 5.x
- 动态路由（根据权限生成菜单）
- 按钮权限指令 `v-auth="sys:user:add"`

### 4.3 核心功能
- [x] JWT Token 认证
- [x] 动态菜单路由
- [x] 按钮级权限
- [x] 数据权限 AOP
- [x] 接口权限校验

## 5. 数据库设计

### 5.1 表结构

```
sys_user        - 用户表
sys_role        - 角色表
sys_menu        - 菜单表
sys_dept        - 部门表
sys_user_role   - 用户角色关联表
sys_role_menu   - 角色菜单关联表
sys_role_dept   - 角色部门关联表（数据权限）
```

### 5.2 ER 关系

```
用户 ←→ 角色（多对多）
角色 ←→ 菜单（多对多）
角色 ←→ 部门（多对多，数据权限）
用户 → 部门（多对一）
菜单 → 菜单（自关联，树结构）
部门 → 部门（自关联，树结构）
```

## 6. 接口设计

### 6.1 认证接口
- POST `/api/auth/login` - 登录
- POST `/api/auth/logout` - 登出
- GET `/api/auth/info` - 获取当前用户信息
- GET `/api/auth/menus` - 获取当前用户菜单

### 6.2 用户管理
- GET `/api/sys/user` - 用户列表
- POST `/api/sys/user` - 新增用户
- PUT `/api/sys/user/{id}` - 更新用户
- DELETE `/api/sys/user/{id}` - 删除用户
- PUT `/api/sys/user/{id}/reset-password` - 重置密码
- PUT `/api/sys/user/{id}/role` - 分配角色

### 6.3 角色管理
- GET `/api/sys/role` - 角色列表
- POST `/api/sys/role` - 新增角色
- PUT `/api/sys/role/{id}` - 更新角色
- DELETE `/api/sys/role/{id}` - 删除角色
- PUT `/api/sys/role/{id}/menu` - 分配菜单权限
- PUT `/api/sys/role/{id}/data-scope` - 设置数据权限

### 6.4 菜单管理
- GET `/api/sys/menu/tree` - 菜单树
- POST `/api/sys/menu` - 新增菜单
- PUT `/api/sys/menu/{id}` - 更新菜单
- DELETE `/api/sys/menu/{id}` - 删除菜单

### 6.5 部门管理
- GET `/api/sys/dept/tree` - 部门树
- POST `/api/sys/dept` - 新增部门
- PUT `/api/sys/dept/{id}` - 更新部门
- DELETE `/api/sys/dept/{id}` - 删除部门

## 7. 前端页面

| 页面 | 路由 | 说明 |
|------|------|------|
| 登录页 | /login | 登录表单 |
| 用户管理 | /sys/user | 用户 CRUD + 分配角色 |
| 角色管理 | /sys/role | 角色 CRUD + 分配菜单 |
| 菜单管理 | /sys/menu | 菜单树管理 |
| 部门管理 | /sys/dept | 部门树管理 |

## 8. 验收标准

- [ ] 用户登录后获取动态菜单
- [ ] 不同角色用户看到不同菜单
- [ ] 按钮权限控制生效（无权限按钮隐藏）
- [ ] 数据权限隔离生效（按部门/个人）
- [ ] 角色分配菜单后立即生效
- [ ] 支持多角色用户（权限取并集）

---
> CX System PRD
> 功能: 权限管理系统
